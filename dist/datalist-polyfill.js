var e=window.document,t=window.navigator.userAgent,i="list"in e.createElement("input")&&Boolean(e.createElement("datalist")&&window.HTMLDataListElement),a=Boolean(t.match(/MSIE\s1[01]./)||t.match(/rv:11./)),n=Boolean(-1!==t.indexOf("Edge/"));!i||a||n||exit,Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);var o=!1,r=["text","email","number","search","tel","url"];window.addEventListener("touchstart",function e(){o=!0,window.removeEventListener("touchstart",e)});var l,s=window.MutationObserver||window.WebKitMutationObserver;void 0!==s&&(l=new s(function(t){var i=!1;if(t.forEach(function(e){e.target instanceof HTMLElement&&"datalist"===e.target.tagName.toLowerCase()&&e.addedNodes.length>1&&(i=e.target)}),i){var a=e.querySelector('input[list="'+i.id+'"]');""!==f(a)&&A(b(i,a).length,i.getElementsByClassName("polyfilling")[0])}}));var u=function(e){var t=e.target,i=t.list,r=38===e.keyCode||40===e.keyCode;if("input"===t.tagName.toLowerCase()&&null!==i)if(a||n)""===f(t)||r||13===e.keyCode||27===e.keyCode||!a&&"text"!==t.type||(d(t,i),t.focus());else{var l=!1,s=i.getElementsByClassName("polyfilling")[0]||h(t,i);if(27!==e.keyCode&&13!==e.keyCode&&(""!==f(t)||r)&&void 0!==s){b(i,t).length>0&&(l=!0);var u=s.options.length-1;o?s.selectedIndex=0:r&&"number"!==t.getAttribute("type")&&(s.selectedIndex=38===e.keyCode?u:0,s.focus())}A(l,s)}},d=function(e,t){var i=f(e);Array.prototype.slice.call(t.options,0).forEach(function(e){var t=e.getAttribute("data-originalvalue"),a=t||e.value;t||e.setAttribute("data-originalvalue",a),e.label||e.text||(e.label=a),e.value=c(e,i)?i+"###[P0LYFlLLed]###"+a.toLowerCase():a})},p=function(e){var t=e.target,i=t.list;if(t.matches("input[list]")&&t.matches(".polyfilled")&&i){var a=i.querySelector('option[value="'+f(t).replace(/\\([\s\S])|(")/g,"\\$1$2")+'"]');a&&a.getAttribute("data-originalvalue")&&g(t,a.getAttribute("data-originalvalue"))}},c=function(e,t){var i=e.value.toLowerCase(),a=t.toLowerCase(),n=e.getAttribute("label"),o=e.text.toLowerCase();return Boolean(!1===e.disabled&&(""!==i&&-1!==i.indexOf(a)||n&&-1!==n.toLowerCase().indexOf(a)||""!==o&&-1!==o.indexOf(a)))},v=function(e){if(e.target.matches("input[list]")){var t=e.target,i=t.list;if("input"===t.tagName.toLowerCase()&&null!==i){if(t.matches(".polyfilled")||y(t,e.type),n&&"focusin"===e.type){var o=t.list.options[0];o.value=o.value}if(!a&&!n){var r=i.getElementsByClassName("polyfilling")[0]||h(t,i),l=r&&r.querySelector("option:not(:disabled)")&&("focusin"===e.type&&""!==f(t)||e.relatedTarget&&e.relatedTarget===r);A(l,r)}}}},y=function(e,t){e.setAttribute("autocomplete","off"),e.setAttribute("role","textbox"),e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-autocomplete","list"),e.setAttribute("aria-owns",e.getAttribute("list")),"focusin"===t?(e.addEventListener("keyup",u),e.addEventListener("focusout",v,!0),(a||n&&"text"===e.type)&&e.addEventListener("input",p)):"blur"===t&&(e.removeEventListener("keyup",u),e.removeEventListener("focusout",v,!0),(a||n&&"text"===e.type)&&e.removeEventListener("input",p)),e.className+=" polyfilled"},f=function(e){return"email"===e.getAttribute("type")&&null!==e.getAttribute("multiple")?e.value.slice(Math.max(0,e.value.lastIndexOf(",")+1)):e.value},g=function(e,t){var i;e.value="email"===e.getAttribute("type")&&null!==e.getAttribute("multiple")&&(i=e.value.lastIndexOf(","))>-1?e.value.slice(0,i)+","+t:t};e.addEventListener("focusin",v,!0),(a||n)&&exit;var m,b=function(t,i){void 0!==l&&l.disconnect();var a=t.getElementsByClassName("polyfilling")[0]||h(i,t),n=f(i),r=e.createDocumentFragment(),s=e.createDocumentFragment();Array.prototype.slice.call(t.querySelectorAll("option:not(:disabled)")).sort(function(e,t){var a=e.value,n=t.value;return"url"===i.getAttribute("type")&&(a=a.replace(/(^\w+:|^)\/\//,""),n=n.replace(/(^\w+:|^)\/\//,"")),a.localeCompare(n)}).forEach(function(e){var t=e.value,i=e.getAttribute("label"),a=e.text;if(c(e,n)){var o=a.slice(0,t.length+" / ".length);a&&!i&&a!==t&&o!==t+" / "?e.textContent=t+" / "+a:e.text||(e.textContent=i||t),r.appendChild(e)}else s.appendChild(e)}),a.appendChild(r);var u=a.options.length;return a.size=u>10?10:u,a.multiple=!o&&u<2,(t.getElementsByClassName("ie9_fix")[0]||t).appendChild(s),void 0!==l&&l.observe(t,{childList:!0}),a.options},h=function(t,i){if(!(t.getAttribute("type")&&-1===r.indexOf(t.getAttribute("type"))||null===i)){var a=t.getClientRects(),n=window.getComputedStyle(t),l=e.createElement("select");if(l.setAttribute("class","polyfilling"),l.style.position="absolute",A(!1,l),l.setAttribute("tabindex","-1"),l.setAttribute("aria-live","polite"),l.setAttribute("role","listbox"),o||l.setAttribute("aria-multiselectable","false"),"block"===n.getPropertyValue("display"))l.style.marginTop="-"+n.getPropertyValue("margin-bottom");else{var s="rtl"===n.getPropertyValue("direction")?"right":"left";l.style.setProperty("margin-"+s,"-"+(a[0].width+parseFloat(n.getPropertyValue("margin-"+s)))+"px"),l.style.marginTop=parseInt(a[0].height+(t.offsetTop-i.offsetTop),10)+"px"}if(l.style.borderRadius=n.getPropertyValue("border-radius"),l.style.minWidth=a[0].width+"px",o){var u=e.createElement("option");u.textContent=i.title,u.disabled=!0,u.setAttribute("class","message"),l.appendChild(u)}return i.appendChild(l),l.addEventListener(o?"change":"click",w),l.addEventListener("blur",w),l.addEventListener("keydown",w),l.addEventListener("keypress",E),l}},E=function(t){var i=t.target,a=i.parentNode,n=e.querySelector('input[list="'+a.id+'"]');"select"===i.tagName.toLowerCase()&&null!==n&&(!t.key||"Backspace"!==t.key&&1!==t.key.length||(n.focus(),"Backspace"===t.key?(n.value=n.value.slice(0,-1),C(n)):n.value+=t.key,b(a,n)))},w=function(t){var i=t.currentTarget,a=i.parentNode,n=e.querySelector('input[list="'+a.id+'"]');if("select"===i.tagName.toLowerCase()&&null!==n){var o=t.type,r="keydown"===o&&13!==t.keyCode&&27!==t.keyCode;("change"===o||"click"===o||"keydown"===o&&(13===t.keyCode||"Tab"===t.key))&&i.value.length>0&&i.value!==a.title?(g(n,i.value),C(n),"Tab"!==t.key&&n.focus(),13===t.keyCode&&t.preventDefault(),r=!1):"keydown"===o&&27===t.keyCode&&n.focus(),A(r,i)}},C=function(t){var i;"function"==typeof Event?i=new Event("input",{bubbles:!0}):(i=e.createEvent("Event")).initEvent("input",!0,!1),t.dispatchEvent(i)},A=function(t,i){t?i.removeAttribute("hidden"):i.setAttributeNode(e.createAttribute("hidden")),i.setAttribute("aria-hidden",(!t).toString())};(m=window.HTMLInputElement)&&m.prototype&&void 0===m.prototype.list&&Object.defineProperty(m.prototype,"list",{get:function(){var t=e.getElementById(this.getAttribute("list"));return"object"==typeof this&&this instanceof m&&t&&t.matches("datalist")?t:null}}),function(e){e&&e.prototype&&void 0===e.prototype.options&&Object.defineProperty(e.prototype,"options",{get:function(){return"object"==typeof this&&this instanceof e?this.getElementsByTagName("option"):null}})}(window.HTMLElement);var x={prepareElement:prepareElement};module.exports=x;
//# sourceMappingURL=datalist-polyfill.js.map
