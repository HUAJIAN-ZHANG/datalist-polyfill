!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).datalistPolyfill=t()}(this,function(){var e=window.document,t=window.navigator.userAgent,i="list"in e.createElement("input")&&Boolean(e.createElement("datalist")&&window.HTMLDataListElement),n=Boolean(t.match(/MSIE\s1[01]./)||t.match(/rv:11./)),a=Boolean(-1!==t.indexOf("Edge/"));!i||n||a||exit,Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);var o=!1,r=" / ",l=["text","email","number","search","tel","url"],s="polyfilling";window.addEventListener("touchstart",function e(){o=!0,window.removeEventListener("touchstart",e)});var u,d=window.MutationObserver||window.WebKitMutationObserver;void 0!==d&&(u=new d(function(t){var i=!1;if(t.forEach(function(e){e.target instanceof HTMLElement&&"datalist"===e.target.tagName.toLowerCase()&&e.addedNodes.length>1&&(i=e.target)}),i){var n=e.querySelector('input[list="'+i.id+'"]');""!==m(n)&&L(E(i,n).length,i.getElementsByClassName(s)[0])}}));var p=function(e){var t=e.target,i=t.list,r=38===e.keyCode||40===e.keyCode;if("input"===t.tagName.toLowerCase()&&null!==i)if(n||a)""===m(t)||r||13===e.keyCode||27===e.keyCode||!n&&"text"!==t.type||(c(t,i),t.focus());else{var l=!1,u=i.getElementsByClassName(s)[0]||w(t,i);if(27!==e.keyCode&&13!==e.keyCode&&(""!==m(t)||r)&&void 0!==u){E(i,t).length>0&&(l=!0);var d=u.options.length-1;o?u.selectedIndex=0:r&&"number"!==t.getAttribute("type")&&(u.selectedIndex=38===e.keyCode?d:0,u.focus())}L(l,u)}},c=function(e,t){var i=m(e);Array.prototype.slice.call(t.options,0).forEach(function(e){var t=e.getAttribute("data-originalvalue"),n=t||e.value;t||e.setAttribute("data-originalvalue",n),e.label||e.text||(e.label=n),e.value=v(e,i)?i+"###[P0LYFlLLed]###"+n.toLowerCase():n})},f=function(e){var t=e.target,i=t.list;if(t.matches("input[list]")&&t.matches(".polyfilled")&&i){var n=i.querySelector('option[value="'+m(t).replace(/\\([\s\S])|(")/g,"\\$1$2")+'"]');n&&n.getAttribute("data-originalvalue")&&b(t,n.getAttribute("data-originalvalue"))}},v=function(e,t){var i=e.value.toLowerCase(),n=t.toLowerCase(),a=e.getAttribute("label"),o=e.text.toLowerCase();return Boolean(!1===e.disabled&&(""!==i&&-1!==i.indexOf(n)||a&&-1!==a.toLowerCase().indexOf(n)||""!==o&&-1!==o.indexOf(n)))},y=function(e){if(e.target.matches("input[list]")){var t=e.target,i=t.list;if("input"===t.tagName.toLowerCase()&&null!==i){if(t.matches(".polyfilled")||g(t,e.type),a&&"focusin"===e.type){var o=t.list.options[0];o.value=o.value}if(!n&&!a){var r=i.getElementsByClassName(s)[0]||w(t,i),l=r&&r.querySelector("option:not(:disabled)")&&("focusin"===e.type&&""!==m(t)||e.relatedTarget&&e.relatedTarget===r);L(l,r)}}}},g=function(e,t){e.setAttribute("autocomplete","off"),e.setAttribute("role","textbox"),e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-autocomplete","list"),e.setAttribute("aria-owns",e.getAttribute("list")),"focusin"===t?(e.addEventListener("keyup",p),e.addEventListener("focusout",y,!0),(n||a&&"text"===e.type)&&e.addEventListener("input",f)):"blur"===t&&(e.removeEventListener("keyup",p),e.removeEventListener("focusout",y,!0),(n||a&&"text"===e.type)&&e.removeEventListener("input",f)),e.className+=" polyfilled"},m=function(e){return"email"===e.getAttribute("type")&&null!==e.getAttribute("multiple")?e.value.slice(Math.max(0,e.value.lastIndexOf(",")+1)):e.value},b=function(e,t){var i;e.value="email"===e.getAttribute("type")&&null!==e.getAttribute("multiple")&&(i=e.value.lastIndexOf(","))>-1?e.value.slice(0,i)+","+t:t};e.addEventListener("focusin",y,!0),(n||a)&&exit;var h,E=function(t,i){void 0!==u&&u.disconnect();var n=t.getElementsByClassName(s)[0]||w(i,t),a=m(i),l=e.createDocumentFragment(),d=e.createDocumentFragment();Array.prototype.slice.call(t.querySelectorAll("option:not(:disabled)")).sort(function(e,t){var n=e.value,a=t.value;return"url"===i.getAttribute("type")&&(n=n.replace(/(^\w+:|^)\/\//,""),a=a.replace(/(^\w+:|^)\/\//,"")),n.localeCompare(a)}).forEach(function(e){var t=e.value,i=e.getAttribute("label"),n=e.text;if(v(e,a)){var o=n.slice(0,t.length+r.length);n&&!i&&n!==t&&o!==t+r?e.textContent=t+r+n:e.text||(e.textContent=i||t),l.appendChild(e)}else d.appendChild(e)}),n.appendChild(l);var p=n.options.length;return n.size=p>10?10:p,n.multiple=!o&&p<2,(t.getElementsByClassName("ie9_fix")[0]||t).appendChild(d),void 0!==u&&u.observe(t,{childList:!0}),n.options},w=function(t,i){if(!(t.getAttribute("type")&&-1===l.indexOf(t.getAttribute("type"))||null===i)){var n=t.getClientRects(),a=window.getComputedStyle(t),r=e.createElement("select");if(r.setAttribute("class",s),r.style.position="absolute",L(!1,r),r.setAttribute("tabindex","-1"),r.setAttribute("aria-live","polite"),r.setAttribute("role","listbox"),o||r.setAttribute("aria-multiselectable","false"),"block"===a.getPropertyValue("display"))r.style.marginTop="-"+a.getPropertyValue("margin-bottom");else{var u="rtl"===a.getPropertyValue("direction")?"right":"left";r.style.setProperty("margin-"+u,"-"+(n[0].width+parseFloat(a.getPropertyValue("margin-"+u)))+"px"),r.style.marginTop=parseInt(n[0].height+(t.offsetTop-i.offsetTop),10)+"px"}if(r.style.borderRadius=a.getPropertyValue("border-radius"),r.style.minWidth=n[0].width+"px",o){var d=e.createElement("option");d.textContent=i.title,d.disabled=!0,d.setAttribute("class","message"),r.appendChild(d)}return i.appendChild(r),r.addEventListener(o?"change":"click",A),r.addEventListener("blur",A),r.addEventListener("keydown",A),r.addEventListener("keypress",C),r}},C=function(t){var i=t.target,n=i.parentNode,a=e.querySelector('input[list="'+n.id+'"]');"select"===i.tagName.toLowerCase()&&null!==a&&(!t.key||"Backspace"!==t.key&&1!==t.key.length||(a.focus(),"Backspace"===t.key?(a.value=a.value.slice(0,-1),x(a)):a.value+=t.key,E(n,a)))},A=function(t){var i=t.currentTarget,n=i.parentNode,a=e.querySelector('input[list="'+n.id+'"]');if("select"===i.tagName.toLowerCase()&&null!==a){var o=t.type,r="keydown"===o&&13!==t.keyCode&&27!==t.keyCode;("change"===o||"click"===o||"keydown"===o&&(13===t.keyCode||"Tab"===t.key))&&i.value.length>0&&i.value!==n.title?(b(a,i.value),x(a),"Tab"!==t.key&&a.focus(),13===t.keyCode&&t.preventDefault(),r=!1):"keydown"===o&&27===t.keyCode&&a.focus(),L(r,i)}},x=function(t){var i;"function"==typeof Event?i=new Event("input",{bubbles:!0}):(i=e.createEvent("Event")).initEvent("input",!0,!1),t.dispatchEvent(i)},L=function(t,i){t?i.removeAttribute("hidden"):i.setAttributeNode(e.createAttribute("hidden")),i.setAttribute("aria-hidden",(!t).toString())};return(h=window.HTMLInputElement)&&h.prototype&&void 0===h.prototype.list&&Object.defineProperty(h.prototype,"list",{get:function(){var t=e.getElementById(this.getAttribute("list"));return"object"==typeof this&&this instanceof h&&t&&t.matches("datalist")?t:null}}),function(e){e&&e.prototype&&void 0===e.prototype.options&&Object.defineProperty(e.prototype,"options",{get:function(){return"object"==typeof this&&this instanceof e?this.getElementsByTagName("option"):null}})}(window.HTMLElement),{prepareElement:prepareElement}});
//# sourceMappingURL=datalist-polyfill.umd.js.map
